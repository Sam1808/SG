# Market for Spider Group
 
>*Преа́мбула: в связи со спецификой условий выполнения задачи, код далее написан исходя из > следующих принципов:*
>   - *Больше, не значит лучше.*
>   - *Сначала функционал, потом оптимизация.*
>   - *Делаешь, как понимаешь.*<br>
>
>*Подробности специфики не уточняются, однако автор полностью согласен со всей критикой в части, например, оптимизации кода.*

<br>

## Общее описание.

### Код написан по заданию [Spider Group](https://spider.ru/).

<br>

**Поставленные задачи:**
- Построить структуру БД используя Django ORM. (*done*)
- Настроить редактирование этих данных в Django admin. (*done*)
- Написать API для получения данных из этих моделей используя DjangoRestFramework (*done*) и django_filters (*todo*).

**Реализованные сущности:**
- Пользователь (*переопределенная модель Django*)
- Категория
- Компания
- Продукт

**Структура БД согласно задания:**<br><br>
![Схема БД](screenshots/01_schema.png)

**Разработаны следующие ресурсы API:**

1. Регистрация пользователя;
2. Авторизация пользователя по DRF токену;
3. Список категорий;
4. Список активных компаний;
5. Список активных продуктов, включая: 
    - фильтрация по компании(*todo*),
    - фильтрация по категории(*todo*),
    - поиск по неполному наименованию(*todo*);
6. Детальная карточка продукта;
7. Создание/Изменение/Удаление (*обязательная авторизация*).

<br>

## 1. Установка. 
<br>

1.1 Скачайте код:<br>
`git clone https://github.com/Sam1808/SG.git`

1.2 Создайте виртуальное окружение, [активируте](https://devpractice.ru/python-lesson-17-virtual-envs/#p33) его и перейдите в папку `spider_project`:<br>
`python3 -m venv _название_окружения_`

1.3 Обновите установщик пакетов `pip` (*не помешает*) и установите зависимости:<br>
`pip install --upgrade pip`
`pip install -r requirements.txt`

1.4 Примените существующие миграции:<br>
`python manage.py migrate`

1.5 Создайте суперпользователя(администратора):<br>
`python manage.py createsuperuser`

1.6 Запустите локальный сервер:<br>
`python manage.py runserver`<br>
Сервер будет доступен по адресу `http://127.0.0.1:8000/`

1.7. Наслаждайтесь :) (*обязательное условие*).
<br><br>

## 2. Использование

<br>

### 2.1 Подготовка 

Для того чтобы проверить корректность работы API по пунктам 3-7 (см. *Разработаны следующие ресурсы API*) предлагается вручную добавить объекты сущностей Категория, Компания, Продукты. Заодно убедиться в правильной работы Django admin (см. *Поставленные задачи*).

Для этого... Переходим в раздел администратора<br>
`http://127.0.0.1:8000/admin/ `<br>
Вводим логин/пароль (*см. пункт 1.5*), получаем следующий интерфейс:<br><br>
![Django admin site](screenshots/02_admin.png)<br><br>
Введите тестовые данные для каждой из сущностей, например так: <br><br>
![Categories](screenshots/03_categories.png)<br>
![Companies](screenshots/03_companies.png)<br>
![Products](screenshots/03_products.png)<br>
<br><br>

### 2.2 Регистрация пользователя

API регистрации пользователя реализовано через Django Rest Framework (DRF), по ссылке: <br>
`http://127.0.0.1:8000/registr/ `<br>
Получаем следующий API интерфейс: <br><br>
![Registration](screenshots/04_registr.png)<br>

Реализованы обязательные поля Логина, Пароля и E-mail`а. <br><br>
Пример *"Создаем пользователя Spiderman"*: <br><br>
![Create spiderman](screenshots/04_create_spiderman.png)<br><br>

В случае успешного создания пользователя API возвращает `"response": true`.

<br>
 
### 2.3 Авторизация пользователя по DRF токену

Авторизация в примерах отражена в пункте **2.8 Создание/Изменение/Удаление**.

Здесь же мы остановимся на создании Токена для пользователя, его проверке и обновления.

Итак, зарегистрированный пользователь может получить Токен на странице: <br>
`http://127.0.0.1:8000/auth/jwt/create`<br>
Для получения Токена необходимо указать Логин и Пароль.

![Create Token for spiderman](screenshots/05_token_create.png)<br><br>

После, API отдает пользователю Токены авторизации и обновления.<br>

![Create spiderman](screenshots/05_token_result.png)<br><br>

Доступность Токена проверяется по ссылке: 
`http://127.0.0.1:8000/auth/jwt/verify` <br>

Обновление Токена: 
`http://127.0.0.1:8000/auth/jwt/refresh`


Использование Токенов реализовано на библиотеке [SimpleJWT](https://github.com/SimpleJWT/django-rest-framework-simplejwt), большинство настроек сохранены по умолчанию.

<br>

### 2.4 Список категорий
API списка Категорий доступно по ссылке:<br>
`http://127.0.0.1:8000/categories/` <br>
Согласно условий - исключительно режим `read only`.

<br>

### 2.5 Список активных компаний
API списка Компаний доступно по ссылке:<br>
`http://127.0.0.1:8000/companies/` <br>
Опять же, исключительно режим `read only`.<br> Обратите внимание, что в списке только *активные* Компании. Т. об. если на шаге 2.1 при внесении компаний вы не указали *Доступность компании* (по умолчанию значение False), то по запросу к API вы получите пустой список.

<br>

### 2.6 Список активных продуктов

API списка Продуктов доступно по ссылке:<br>
`http://127.0.0.1:8000/activeproducts/` <br>
Традиционно режим `read only` и только продукты с отмеченным флагом *Доступность продукта*.

**Важно**: Фильтрация на текущий момент НЕ реализована (*необходимо уточнение от заказщика*).
<br>
<br>

### 2.7 Список активных продуктов

API Детальной карточки продукта доступно по ссылке:<br>
`http://127.0.0.1:8000/product/<int:pk>`<br> 
Где `<int:pk>` - это `id` Продукта, чью детальную карточку вы хотите просмотреть/получить. И конечно же - `read only`.

<br>

### 2.8 Создание/Изменение/Удаление

Реализовано API Создание/Изменение/Удаление... для сущности "Продукт". Для операций CRUD неоходима авторизация по JWT (*наконец-таки!*). 
При этом "Создание" отделено от "Изменения/Удаления" по разным ресурсам API (*хотите узначть почему - спросите у меня об этом при личной встрече*). 
Далее все процессы CRUD будут описаны примерами, для реализации примеров используем [Postman](https://www.postman.com/).
<br><br>
#### 2.8.1 Создание объекта cущности Продукт при обязательной JWT авторизации.

Для начала выберем пользователя, от чьего имени будем авторизовываться, проверим доступность его Токена и при необходимости обновим его (*все то, что вы делали пункте 2.2*)

API создания объекта реализовано по ссылке:<br>
`http://127.0.0.1:8000/createproduct/` <br>

Для успешной авторизации укажем в интерфейсе [Postman](https://www.postman.com/) легитимный Токен выбранного пользователя:<br>
[здесь будет картинка]<br>
В теле (*Body*) запроса укажем обязательные поля для создания продукта и отправим запрос `POST`.<br>
[здесь будет картинка]<br>


... и это ещё не конец


